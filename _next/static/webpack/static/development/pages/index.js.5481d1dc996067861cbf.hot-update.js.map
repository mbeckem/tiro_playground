{"version":3,"file":"static/webpack/static\\development\\pages\\index.js.5481d1dc996067861cbf.hot-update.js","sources":["webpack:///./src/pages/index.tsx"],"sourcesContent":["import { Component } from \"react\";\nimport TiroCompiler, { createCompiler, CompilerResult } from \"../TiroCompiler\";\nimport { CompilerView } from \"../components/CompilerView\";\n\ninterface PlaygroundState {\n    compiling: boolean;\n    currentSource: string;\n    compiler?: TiroCompiler;\n    result?: CompilerResult;\n}\n\nconst INITIAL_SOURCE = `\nimport std;\n\nfunc foo() {\n    for (var i = 1; i <= 10; i += 1) {\n        std.print(i);\n    }\n}\n`.trim();\n\nfunction asyncSetState<T extends Component, S>(\n    comp: Component,\n    newState: S\n): Promise<void> {\n    return new Promise((resolve) => {\n        comp.setState(newState, resolve);\n    });\n}\n\nexport default class Playground extends Component<{}, PlaygroundState> {\n    constructor(props: any) {\n        super(props);\n        this.state = {\n            compiling: false,\n            currentSource: INITIAL_SOURCE,\n        };\n    }\n\n    async componentDidMount(): Promise<void> {\n        let compiler;\n        try {\n            compiler = await createCompiler();\n        } catch (e) {\n            console.error(\"Failed to create compiler instance\", e);\n            return;\n        }\n\n        await asyncSetState(this, { compiler });\n        this._startCompilation();\n    }\n\n    componentWillUnmount(): void {\n        this.state.compiler?.destroy();\n    }\n\n    private async _startCompilation(): Promise<void> {\n        // TODO: Async compilation api (Web worker?)\n        try {\n            const { compiler, currentSource } = this.state;\n            await asyncSetState(this, { compiling: true });\n            const result = compiler?.compile(currentSource);\n            await asyncSetState(this, { compiling: false, result });\n        } catch (e) {\n            // TODO: Error state in UI\n            console.error(\"Compilation failed\", e);\n        }\n    }\n\n    render(): JSX.Element {\n        const { compiling, compiler, result } = this.state;\n        if (!compiler || !result) {\n            return <div>Loading...</div>;\n        }\n\n        const messages = result.messages.map((message, index) => {\n            return <li key={index}>{message}</li>;\n        });\n\n        /*   \n        return (\n            <div>\n                <div>Success: {result.success.toString()}</div>\n                <div>Time taken: {result.elapsedMillis.toFixed(3)} ms</div>\n                <div>Messages:</div>\n                <ul>{messages}</ul>\n                <pre>{result.ast}</pre>\n                <pre>{result.ir}</pre>\n                <pre>{result.bytecode}</pre>\n                <Editor\n                    initialSource={this.state.result?.ast || \"\"}\n                    onChange={this._sourceChanged}\n                />\n            </div>\n            );\n        */\n        return (\n            <CompilerView\n                compiling={compiling}\n                initialSource={INITIAL_SOURCE}\n                result={result}\n                onSourceChanged={this._handleSourceChanged}\n            ></CompilerView>\n        );\n    }\n\n    private _handleSourceChanged = (value: string): void => {\n        this._startCompilation(value);\n    };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AASA;AACA;AASA;AAIA;AACA;AACA;AACA;AACA;AACA;;;;;AACA;AAAA;AACA;AADA;AACA;AAAA;AACA;AAFA;AA4EA;AACA;AACA;AA5EA;AACA;AACA;AAFA;AAFA;AAMA;AACA;;;;;;;;;;;AAIA;AACA;;AADA;;;;;;;AAEA;;;;;AAIA;AAAA;AAAA;AACA;;AAAA;AACA;;;;;;;;;;AAEA;AAAA;AACA;AAAA;AACA;;;;;;;;;;;AAKA;;AACA;AAAA;AAAA;AACA;;AAAA;;AACA;AAAA;AAAA;AAAA;AACA;;;;;;;;AACA;AACA;AACA;;;;;;;;;;AAGA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;;;;;;;;;;;;;;;;;;AAiBA;AAEA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;;;;AA1EA;AACA;;;;;A","sourceRoot":""}