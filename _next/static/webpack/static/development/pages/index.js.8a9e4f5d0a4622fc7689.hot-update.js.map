{"version":3,"file":"static/webpack/static\\development\\pages\\index.js.8a9e4f5d0a4622fc7689.hot-update.js","sources":["webpack:///./src/TiroCompiler.ts"],"sourcesContent":["import nativeTiro from \"../lib/tiro\";\nimport nativeTiroWasmURL from \"../lib/tiro.wasm\";\n\nexport interface CompilerResult {\n    success: boolean;\n    ast: string; // String representation of the AST\n    ir: string; // String representation of the SSA IR\n    bytecode: string; // String representation of the final bytecode module\n    messages: string[]; // Compiler errors or warnings\n    elapsedMillis: number; // Time taken for compilation\n}\n\nexport default class TiroCompiler {\n    private _native: any;\n\n    constructor(nativeTiro: any) {\n        this._native = nativeTiro;\n    }\n\n    destroy(): void {\n        if (this._native) {\n            this._native = undefined;\n        }\n    }\n\n    compile(source: string): CompilerResult {\n        this._checkDestroyed();\n\n        const start = new Date();\n        const input = JSON.stringify({ source });\n        const output = JSON.parse(this._native.tiro_compile(input));\n        output.elapsedMillis = new Date().getTime() - start.getTime();\n        return output as CompilerResult;\n    }\n\n    private _checkDestroyed(): void {\n        if (!this._native)\n            throw new Error(\"Tiro compiler was already destroyed.\");\n    }\n}\n\nexport async function createCompiler(): Promise<TiroCompiler> {\n    if (typeof window === \"undefined\") {\n        throw new Error(\"Cannot compile server side.\");\n    }\n\n    const { nativeTiro } = await loadTiro();\n    return new TiroCompiler(nativeTiro);\n}\n\nfunction loadTiro(): Promise<{ nativeTiro: any }> {\n    return new Promise((resolve, reject) => {\n        const instance = nativeTiro({\n            noInitialRun: true,\n            noExitRuntime: true,\n            locateFile(file: any) {\n                if (file === \"tiro.wasm\") {\n                    return nativeTiroWasmURL;\n                }\n                throw new Error(\n                    `Unknown file requested by WebAssembly module: '${file}'.`\n                );\n            },\n            onAbort() {\n                reject(\"Native tiro module aborted.\");\n            },\n            onRuntimeInitialized() {\n                // Must not resolve with the instance itself. It has a \"then\" function\n                // but is *NOT* a promise (-> infinite loop).\n                resolve({\n                    nativeTiro: instance,\n                });\n            },\n        });\n    });\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AAUA;AAGA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AAEA;;;;;;AA1BA;AA6BA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAKA;AALA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AApBA;AAsBA;AACA;;;;A","sourceRoot":""}