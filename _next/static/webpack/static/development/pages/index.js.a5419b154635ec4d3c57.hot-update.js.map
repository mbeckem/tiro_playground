{"version":3,"file":"static/webpack/static\\development\\pages\\index.js.a5419b154635ec4d3c57.hot-update.js","sources":["webpack:///./src/pages/index.tsx"],"sourcesContent":["import { Component } from \"react\";\nimport { CompilationResult, Runtime, createRuntime } from \"../runtime/all\";\nimport { CompilerView } from \"../components/CompilerView\";\n\ninterface PlaygroundState {\n    compiling: boolean;\n    currentSource: string;\n    result?: CompilationResult;\n}\n\nconst INITIAL_SOURCE = `\nimport std;\n\nfunc main() {\n    const object = \"World\";\n    std.print(\"Hello \\${object}!\");\n}\n`.trimStart();\n\nfunction asyncSetState<T extends Component, S>(\n    comp: T,\n    newState: S\n): Promise<void> {\n    return new Promise((resolve) => {\n        comp.setState(newState, resolve);\n    });\n}\n\nexport default class Playground extends Component<{}, PlaygroundState> {\n    private _runtime?: Runtime;\n\n    constructor(props: any) {\n        super(props);\n        this.state = {\n            compiling: false,\n            currentSource: INITIAL_SOURCE,\n        };\n    }\n\n    async componentDidMount(): Promise<void> {\n        let compiler;\n        try {\n            compiler = await createRuntime();\n        } catch (e) {\n            console.error(\"Failed to create compiler instance\", e);\n            return;\n        }\n\n        this._runtime = compiler;\n        this._startCompilation(this.state.currentSource);\n    }\n\n    componentWillUnmount(): void {\n        this._runtime?.destroy();\n        this._runtime = undefined;\n    }\n\n    private async _startCompilation(source: string): Promise<void> {\n        // TODO: Async compilation api (Web worker?)\n        try {\n            await asyncSetState(this, { compiling: true });\n            const result = this._runtime?.compile(source);\n            await asyncSetState(this, { compiling: false, result });\n\n            const exec = this._runtime?.run(\"main\");\n            console.debug(exec);\n        } catch (e) {\n            // TODO: Error state in UI\n            console.error(\"Compilation failed\", e);\n        }\n    }\n\n    render(): JSX.Element {\n        const { compiling, currentSource, result } = this.state;\n        if (!this._runtime || !result) {\n            return <div>Loading...</div>;\n        }\n\n        return (\n            <CompilerView\n                compiling={compiling}\n                initialSource={currentSource}\n                result={result}\n                onSourceChanged={this._handleSourceChanged}\n            ></CompilerView>\n        );\n    }\n\n    private _handleSourceChanged = async (value: string): Promise<void> => {\n        await asyncSetState(this, { currentSource: value });\n        this._startCompilation(value);\n    };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AAQA;AACA;AAQA;AAIA;AACA;AACA;AACA;AACA;AACA;;;;;AAGA;AAAA;AACA;AADA;AACA;AAAA;AACA;AAFA;AACA;AADA;AAyDA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAFA;AAEA;AACA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAxDA;AACA;AACA;AAFA;AAFA;AAMA;AACA;;;;;;;;;;;AAIA;AACA;;AADA;;;;;;;AAEA;;;;AAIA;AACA;AAAA;AACA;;;;;;;;;;AAEA;AAAA;AACA;AAAA;AACA;AACA;;;AAEA;;;;;;;;;AAGA;AAAA;AAAA;AACA;;AAAA;;AACA;AAAA;AAAA;AAAA;AACA;;AACA;AACA;;;;;;;AAEA;AACA;AACA;;;;;;;;;;AAGA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;;;;AA1DA;AACA;;;;;A","sourceRoot":""}